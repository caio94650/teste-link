<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Compatibilidade perto de vocÃª</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --txt:#1b2330; --muted:#708099; --brand:#e63946; --brand2:#b0212d; --ok:#2a9d8f;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--txt)}
  .wrap{max-width:420px;margin:0 auto;min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:18px}
  .card{background:var(--card);width:100%;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.07);padding:22px}
  .brand{display:flex;gap:10px;align-items:center;margin-bottom:8px}
  .brand-dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
  h1{font-size:20px;line-height:1.25;margin:6px 0 14px}
  p{color:var(--muted);margin:0 0 14px}
  .progress{height:8px;background:#e9edf3;border-radius:999px;overflow:hidden;margin:12px 0 18px}
  .bar{height:100%;width:0;background:var(--brand);transition:width .35s ease}
  .q-img{width:100%;border-radius:12px;margin:10px 0}
  .grid{display:grid;gap:10px}
  .grid-2{grid-template-columns:1fr 1fr}
  .btn{appearance:none;border:0;border-radius:12px;background:#eef3f8;color:var(--txt);padding:14px 12px;font-weight:600;cursor:pointer}
  .btn:hover{filter:brightness(.98)}
  .btn.brand{background:var(--brand);color:#fff}
  .btn.brand:hover{background:var(--brand2)}
  .btn.ghost{background:#fff;border:1px solid #e6e9f0}
  .muted{font-size:12px;color:#96a3b6}
  .center{text-align:center}
  .pill{display:inline-flex;gap:6px;align-items:center;background:#f1f5fb;color:#3c4a5f;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:600}
  .loader{display:inline-block;width:10px;height:10px;border:2px solid #c8d2e3;border-top-color:var(--brand);border-radius:50%;animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .hidden{display:none}
  .found{color:var(--ok);font-weight:700}
  footer{margin-top:14px}
  a.clean{color:inherit}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="app">
    <div class="brand"><span class="brand-dot"></span><span class="pill">Compatibilidade â€¢ Passo a passo</span></div>
    <h1 id="title">Perfis prÃ³ximos de <span id="loc-inline">vocÃª</span></h1>
    <p id="subtitle">Responda 3 perguntas rÃ¡pidas para encontrar pessoas compatÃ­veis em <span id="loc-sub">sua regiÃ£o</span>.</p>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <!-- IMAGEM -->
    <img src="https://i.ibb.co/3sZ9dXx/casal-feliz.jpg" alt="Pessoas sorrindo" class="q-img" id="qimg">

    <!-- PASSO 1 -->
    <section id="step1" class="grid grid-2">
      <button class="btn" onclick="choose('gender','Homem')">Sou Homem</button>
      <button class="btn" onclick="choose('gender','Mulher')">Sou Mulher</button>
    </section>

    <!-- PASSO 2 -->
    <section id="step2" class="grid grid-2 hidden">
      <button class="btn" onclick="choose('seeking','Homens')">Procuro Homens</button>
      <button class="btn" onclick="choose('seeking','Mulheres')">Procuro Mulheres</button>
      <button class="btn" onclick="choose('seeking','Ambos')">Ambos</button>
      <button class="btn ghost" onclick="choose('seeking','Prefiro nÃ£o dizer')">Prefiro nÃ£o dizer</button>
    </section>

    <!-- PASSO 3 -->
    <section id="step3" class="grid grid-2 hidden">
      <button class="btn" onclick="choose('age','18-25')">18â€“25</button>
      <button class="btn" onclick="choose('age','26-35')">26â€“35</button>
      <button class="btn" onclick="choose('age','36-45')">36â€“45</button>
      <button class="btn" onclick="choose('age','46+')">46+</button>
    </section>

    <!-- PASSO 4 -->
    <section id="step4" class="grid grid-2 hidden">
      <button class="btn" onclick="choose('goal','Relacionamento sÃ©rio')">Relacionamento sÃ©rio</button>
      <button class="btn" onclick="choose('goal','Encontros casuais')">Encontros casuais</button>
      <button class="btn" onclick="choose('goal','Amizade')">Amizade</button>
      <button class="btn ghost" onclick="choose('goal','Indefinido')">Indefinido</button>
    </section>

    <!-- LOADING -->
    <section id="scan" class="hidden center">
      <p class="pill"><span class="loader"></span> Analisando respostasâ€¦</p>
      <p class="muted">Filtrando perfis prÃ³ximos de <span id="loc-scan">vocÃª</span> com base nas suas preferÃªncias.</p>
      <img src="https://i.ibb.co/zV1xhvN/chat-sedutor.jpg" alt="Busca" class="q-img">
      <div id="scanStatus" class="muted">Procurando compatibilidadesâ€¦ 0%</div>
    </section>

    <!-- RESULTADO -->
    <section id="result" class="hidden">
      <h2 class="found">âœ” Encontramos 7 perfis com alta compatibilidade em <span id="loc-result">sua regiÃ£o</span></h2>
      <p id="summary">Baseado nas suas respostas, selecionamos pessoas que combinam com vocÃª.</p>
      <ul class="muted" id="bullets" style="padding-left:18px;margin:10px 0 0">
        <li>Perfis verificados e com interesses em comum</li>
        <li>Chat discreto e seguro</li>
        <li>InscriÃ§Ã£o gratuita para novos membros</li>
      </ul>
      <div class="grid" style="margin-top:14px">
        <a id="cta" class="btn brand center" href="SUA_URL_AQUI">ðŸ‘‰ Ver meus perfis compatÃ­veis</a>
        <button class="btn ghost" onclick="restart()">Refazer quiz</button>
      </div>
      <p class="muted center" style="margin-top:10px">Vagas locais atualizam em tempo real â€” pode esgotar.</p>
    </section>

    <footer>
      <p class="muted">ConteÃºdo de entretenimento/informativo. NÃ£o exibimos material explÃ­cito. Ao prosseguir, vocÃª concorda com nossos <a class="clean" href="#" onclick="alert('Termos bÃ¡sicos de uso: conteÃºdo informativo, sem garantias de resultado.');return false;">Termos</a>.</p>
    </footer>
  </div>
</div>

<script>
  // =======================
  // ESTADO
  // =======================
  const state = { gender:null, seeking:null, age:null, goal:null, step:1, total:6, city:null, region:null, country:null };
  const el = s => document.querySelector(s);
  const show = id => el(id).classList.remove('hidden');
  const hide = id => el(id).classList.add('hidden');

  // inicial
  detectLocation(); // tenta localizar por IP
  updateUI();

  // =======================
  // QUIZ
  // =======================
  function choose(key,value){
    state[key]=value;
    try{ localStorage.setItem('quizDating', JSON.stringify(state)); }catch(e){}
    next();
  }

  function next(){
    if(state.step===1){ state.step=2; }
    else if(state.step===2){ state.step=3; }
    else if(state.step===3){ state.step=4; }
    else if(state.step===4){ state.step=5; startScan(); }
    updateUI();
  }

  function restart(){
    state.gender=state.seeking=state.age=state.goal=null;
    state.step=1;
    updateUI(true);
  }

  function updateUI(resetImg){
    // progress
    const percent = Math.min(Math.round((state.step-1)/state.total*100), 100);
    el('#bar').style.width = percent + '%';

    // titles
    const where = prettyLoc();
    const titles = {
      1: {t:`Perfis prÃ³ximos de ${where || 'vocÃª'}`, s:`Responda 3 perguntas rÃ¡pidas para encontrar pessoas compatÃ­veis em ${where || 'sua regiÃ£o'}.`, img:'https://i.ibb.co/3sZ9dXx/casal-feliz.jpg'},
      2: {t:'Quem vocÃª quer conhecer?', s:'Isso ajuda a mostrar apenas pessoas do seu interesse.', img:'https://i.ibb.co/3sZ9dXx/casal-feliz.jpg'},
      3: {t:'Qual faixa etÃ¡ria te interessa?', s:'VocÃª pode ajustar depois, se quiser.', img:'https://i.ibb.co/3sZ9dXx/casal-feliz.jpg'},
      4: {t:'O que vocÃª busca agora?', s:'Sem julgamentos â€” escolha o que faz sentido pra vocÃª.', img:'https://i.ibb.co/3sZ9dXx/casal-feliz.jpg'},
      5: {t:'Analisando suas respostasâ€¦', s:`Filtrando perfis prÃ³ximos de ${where || 'vocÃª'} com base nas suas preferÃªncias.`, img:'https://i.ibb.co/zV1xhvN/chat-sedutor.jpg'},
      6: {t:'Pronto! Achamos combinaÃ§Ãµes ideais', s:'Veja seus perfis compatÃ­veis e inicie a conversa agora mesmo.', img:'https://i.ibb.co/zV1xhvN/chat-sedutor.jpg'}
    };
    const cur = titles[state.step] || titles[1];
    el('#title').textContent = cur.t;
    el('#subtitle').textContent = cur.s;
    if(resetImg!==false){ el('#qimg').src = cur.img; }

    // injeta localizaÃ§Ã£o nos pontos-chave
    setText('#loc-inline', where || 'vocÃª');
    setText('#loc-sub', where || 'sua regiÃ£o');
    setText('#loc-scan', where || 'vocÃª');
    setText('#loc-result', where || 'sua regiÃ£o');

    // steps visibility
    ['#step1','#step2','#step3','#step4','#scan','#result'].forEach(id=>hide(id));
    if(state.step===1) show('#step1');
    if(state.step===2) show('#step2');
    if(state.step===3) show('#step3');
    if(state.step===4) show('#step4');
    if(state.step===5) show('#scan');
    if(state.step===6){
      // resumo dinÃ¢mico
      const parts = [];
      if(state.gender) parts.push(`VocÃª Ã© ${state.gender.toLowerCase()}`);
      if(state.seeking && state.seeking!=='Prefiro nÃ£o dizer') parts.push(`procura ${state.seeking.toLowerCase()}`);
      if(state.age) parts.push(`na faixa ${state.age}`);
      if(state.goal && state.goal!=='Indefinido') parts.push(`para ${state.goal.toLowerCase()}`);
      if(where) parts.push(`em ${where}`);
      el('#summary').textContent = parts.length ? parts.join(', ') + '.' : 'Baseado nas suas respostas, selecionamos pessoas que combinam com vocÃª.';

      // CTA com UTM + geoloc
      const url = new URL('SUA_URL_AQUI', location.href);
      url.searchParams.set('utm_source','taboola');
      url.searchParams.set('utm_campaign','quiz_compatibilidade');
      url.searchParams.set('g', state.gender||'');
      url.searchParams.set('s', state.seeking||'');
      url.searchParams.set('a', state.age||'');
      url.searchParams.set('goal', state.goal||'');
      if(state.city) url.searchParams.set('loc_city', state.city);
      if(state.region) url.searchParams.set('loc_region', state.region);
      if(state.country) url.searchParams.set('loc_country', state.country);
      el('#cta').href = url.toString();

      show('#result');
    }
  }

  function startScan(){
    let pct = 0;
    const status = el('#scanStatus');
    const timer = setInterval(()=>{
      pct += Math.floor(Math.random()*17)+6;
      if(pct>100) pct=100;
      status.textContent = `Procurando compatibilidadesâ€¦ ${pct}%`;
      if(pct>=100){
        clearInterval(timer);
        setTimeout(()=>{ state.step=6; updateUI(false); }, 400);
      }
    }, 450);
  }

  function setText(sel, val){ const n = el(sel); if(n) n.textContent = val; }
  function prettyLoc(){
    if(state.city && state.region){ return `${state.city}/${state.region}`; }
    if(state.city && state.country){ return `${state.city}, ${state.country}`; }
    if(state.region && state.country){ return `${state.region}, ${state.country}`; }
    if(state.country){ return state.country; }
    return '';
  }

  // =======================
  // GEOLOCALIZAÃ‡ÃƒO POR IP
  // =======================
  async function detectLocation(){
    try{
      // 1) Tenta ipapi.co (rÃ¡pido e com CORS)
      let data = await fetch('https://ipapi.co/json/').then(r=>r.ok?r.json():Promise.reject());
      if(data){
        state.city   = data.city || null;
        state.region = (data.region_code || data.region || '').replace('State of ','') || null;
        state.country= data.country_name || data.country || null;
        updateUI(false);
        return;
      }
    }catch(e){}
    try{
      // 2) Fallback: ipwho.is
      let data = await fetch('https://ipwho.is/').then(r=>r.ok?r.json():Promise.reject());
      if(data && data.success!==false){
        state.city   = data.city || null;
        state.region = data.region || null;
        state.country= data.country || null;
        updateUI(false);
        return;
      }
    }catch(e){}
    // 3) Sem localizaÃ§Ã£o â€” segue normal
    updateUI(false);
  }
</script>
</body>
</html>
